name: Wake Hugging Face Spaces

on:
  schedule:
    # Run every 30 minutes (UTC)
    - cron: "*/30 * * * *"
  workflow_dispatch:

jobs:
  wake_spaces:
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
      - name: Ping Hugging Face Spaces
        shell: bash
        run: |
          set -e

          SPACES=(
            "https://kacapower-blogger-source-downloader.hf.space/"
            "https://kacapower-blogger-toolkit.hf.space/"
            "https://kacapower-repo-cloner-tool.hf.space/"
            "https://kacapower-backend-filehandler.hf.space/"
            "https://kacapower-videostream.hf.space/"
          )

          USER_AGENT="Mozilla/5.0 (X11; Linux x86_64) GitHubActions/SpaceWake"

          for SPACE in "${SPACES[@]}"; do
            echo "----------------------------------------"
            echo "Waking: $SPACE"

            HTTP_CODE=$(curl -L \
              -A "$USER_AGENT" \
              --max-time 20 \
              --silent \
              --output /dev/null \
              --write-out "%{http_code}" \
              "$SPACE" || echo "000")

            if [[ "$HTTP_CODE" == "200" ]]; then
              echo "✅ Space responded (HTTP 200)"
            elif [[ "$HTTP_CODE" == "503" ]]; then
              echo "⏳ Space is waking up (503)"
            else
              echo "⚠️ Unexpected response: $HTTP_CODE"
            fi

            sleep 15
          done

          echo "----------------------------------------"
          echo "All spaces processed."
